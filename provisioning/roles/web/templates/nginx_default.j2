server {
	listen 80 default_server;
	server_name {{ ansible_facts['fqdn'] }};
    	location /stub_status {
        	stub_status on;
        	access_log off;
		allow 172.18.0.0/16;
          	deny all;
    	}
    	location / {
        	rewrite  ^ https://$server_name$request_uri? permanent;
    	}
	#return 301 https://$server_name$request_uri;
}

server {
	listen 443 ssl;
	root /config/www;
	index index.html index.htm index.php;

	server_name _;

	ssl_certificate /config/keys/cert.crt;
	ssl_certificate_key /config/keys/cert.key;

	client_max_body_size 0;
        auth_basic "Private Property";
        auth_basic_user_file /config/nginx/.htpasswd;


	location / {
		try_files $uri $uri/ /index.html /index.php?$args =404;
	}

	location ~ \.php$ {
		fastcgi_split_path_info ^(.+\.php)(/.+)$;
		# With php5-cgi alone:
		fastcgi_pass 127.0.0.1:9000;
		# With php5-fpm:
		#fastcgi_pass unix:/var/run/php5-fpm.sock;
		fastcgi_index index.php;
		include /etc/nginx/fastcgi_params;

	}
	# sickchill reverse proxy
	location /sickchill { 
		proxy_pass http://sickchill:8081;
		#proxy_redirect off;
		#proxy_set_header Host $http_host;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}
	# transmission reverse proxy
	location /transmission {
		proxy_pass http://transmission:9091;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}
}
